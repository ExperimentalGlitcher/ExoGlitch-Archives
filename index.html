
<!doctype html>
<html lang="en" id="mainBody">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Nabla&family=Rubik+80s+Fade&family=Alfa+Slab+One&family=Bebas+Neue&family=Bungee&family=Cutive+Mono&family=Dancing+Script:wght@500&family=Fredoka+One&family=Indie+Flower&family=Merienda&family=Nanum+Brush+Script&family=Neonderthaw&family=Pacifico&family=Passion+One&family=Permanent+Marker&family=Rampart+One&family=Roboto+Mono:wght@500&family=Share+Tech+Mono&family=Syne+Mono&family=Ubuntu:wght@400;700&family=Zen+Dots&display=swap" rel="stylesheet">
<style type="text/css">
    body {
        overflow: hidden;
    }
</style>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
    <meta http-equiv="Pragma" content="no-cache"/>
    <meta http-equiv="Expires" content="0"/>
    <title>ExoGlitch.io</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <meta name="description"  content="ExoGlitch.io, a fan-made spinoff between woomy-arras.io & arras.io & diep.io, with hundreds of tanks, bosses, and more!">
    <meta name="robots" content="index, follow">
    <meta name="keywords" content=".io, arras, arras.io, arrasio, fun game, game, io game, online game, private server, tank game, exoglitch, exoglitch.io, exoglitchio">
    <meta property="og:image" content="./resources/exoglitch-io-logo.png" />
    <meta property="og:image:width" content="52" />
    <meta property="og:image:height" content="52" />
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="192x192" href="./resources/exoglitch-io-logo.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./resources/exoglitch-io-logo.png">
    <link rel="icon" type="image/png" sizes="96x96" href="./resources/exoglitch-io-logo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./resources/exoglitch-io-logo.png">
    <meta name="theme-color" content="#8ABC3F">
    
    <script src="./multiplayer.js"></script>
    <script>
        const isLocal = true//window.location.hostname === "localhost";
        const isBeta = window.location.hostname === "beta.exoglitch.io";
        const isEvent = window.location.hostname === "event.exoglitch.io";
    </script>
    <script src="./app.js" defer></script>
    <link rel="stylesheet" href="./menu.css">
    <!-- Eval packet thing-->
    <script>
        const $a = (Math.random() * 9000000 | 0) + 1000000;
        const $b = (Math.random() * 9000000 | 0) + 1000000;
        const $c = (Math.random() * 9000000 | 0) + 1000000;
        const $d = (Math.random() * 9000000 | 0) + 1000000;
        const $e = (Math.random() * 9000000 | 0) + 1000000;
        Object.defineProperty(window, "_$a", {
            get() {
                return $a;
            },
            set() {
                return $a;
            }
        });
        Object.defineProperty(window, "_$b", {
            get() {
                return $b;
            },
            set() {
                return $b;
            }
        });
        Object.defineProperty(window, "_$c", {
            get() {
                return $c;
            },
            set() {
                return $c;
            }
        });
        Object.defineProperty(window, "_$d", {
            get() {
                return $d;
            },
            set() {
                return $d;
            }
        });
        Object.defineProperty(window, "_$e", {
            get() {
                return $e;
            },
            set() {
                return $e;
            }
        });
    </script>
</head>

<body oncontextmenu="return false;" id="mainBody">
    <div id="loadingScreen" style="display:flex;position: absolute;z-index: 100000;background: black;color: white;width: 100%;height: 100%;justify-content: center;flex-direction: column;">
      <h1 id="loadingText"  style="color:white;font-size:xxx-large;">
        Loading Files...
      </h1>
      <h5 style="color:white;font-size:xx-small;">
        Created by EPMG
      </h5>
    </div>
    <script>
      
      let loadingMenu = document.getElementById("loadingScreen")
      let loadingText = document.getElementById("loadingText")
      let dotCounter = 0
      let loadingMenuInterval = setInterval(()=>{
        dotCounter++
        
        let str = ""
        
        let text = "";
        if(window.connectedToWRM !== true){
          text = "Connecting..."
        }
        
        if(dotCounter === text.length) dotCounter = 0
        for(let i = 0; i < text.length; i++){
          if(dotCounter === i){
            str += `<i style="color:white;font-size:xxx-large;">${text[i]}</i>`
            continue;
          }
          str += text[i]
        }
        loadingText.innerHTML = str
        if(window.connectedToWRM){
          loadingMenu.remove()
          clearInterval(loadingMenuInterval)
        }
      }, 100)
    </script>
    <div class="background"></div>
    <div id="gameAreaWrapper">
        <canvas id="gameCanvas" tabindex="1"></canvas>
    </div>
    <div id="wrapperWrapper">
        <div id="mainWrapper">
            <div id="startMenuWrapper">
                <div id="startMenu">
                    <div class="startMenuHolder" style="padding-right: 18px;">
                        <iframe onclick="window.open('https://discord.gg/ShsZTkZb8P');"
                            src="https://discord.com/widget?id=1025667084916629534&theme=dark"
                            style="width: 100%; height: 90%;" allowtransparency="true" frameborder="0"></iframe>
                        <div class="bottomHolder">
                            <a style="background: #2bab2f; width: 25%" href="javascript:void(0)"
                                onclick="displayAchievements()">Achievements</a>
                            <a style="background: #3e5f85; width: 25%" href="https://experimentalglitcher.github.io/ExoGlitch-io/" target="_blank">ExoGlitch.io</a>
                            <a class="patreon" href="/itiswhatitis.html" target="_blank">What is this?</a>
                            <!--<a style="background: #5571d7; width: 105px" href="javascript:void(0)" onclick="displayMission()">Mission</a>-->
                            <!--<a style="background: #c53333; width: 105px" href="javascript:void(0)" onclick="displayDisclaimer()">Disclaimer</a>-->
                        </div>
                    </div>
                    <div class="startMenuHolder">
                        <div class="sliderHolder">
                            <div class="slider" id="startMenuSlidingContent">
                                <center><a href="//experimentalglitcher.github.io/ExoGlitch-io/" tabindex="-1"><img class="icon"
                                            src="./resources/exoglitch-io-logo.png" alt="ExoGlitch" /></a></center>
                                <h1>ExoGlitch.io</h1>
                                <div id="serverFilterHolder" class="serverSelectorFilters">
                                    <button class="selectedButton" id="serverfilter_auto">Create Room</button>
                                    <button id="serverfilter_manual">Join Room</button>
                                </div>
                                <div class="serverSelectorSearch">
                                  <input placeholder="Search" id="serverSearch">
                                </div>
                                <div class="serverSelector shadowScroll">
                                    <table>
                                        <tbody id="serverSelector"></tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="slider" id="startMenuSlidingContent"><br>
                                <div class="keybindHolder shadowScroll" style="scroll-margin: 200px;">
                                    <table class="optionstable">
                                        <tr>
                                            <td>
                                                <div class="bottomHolder" style="display: flex; justify-content: center;"><a
                                                        style="background: #9377a9; width: 120px; margin: 0px;"
                                                        href="javascript:void(0)" onclick="displayHowToPlay()">How to
                                                        play</a>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="bottomHolder" style="display: flex; justify-content: center;"><a
                                                        style="background: #4f7851; width: 120px; margin: 0px;"
                                                        href="javascript:void(0)" onclick="displayAbout()">About ExoGlitch</a>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                    <hr>
                                    <optionsheader>Miscellaneous Controls:</optionsheader>
                                    <table class="optionsTable">
                                        <tr>
                                            <td><b>E</b>: Autofire</td>
                                            <td><b>C</b>: Autospin</td>
                                        </tr>
                                        <tr>
                                            <td><b>Q</b>: Transform</td>
                                            <td><b>M</b>: Max Stat</td>
                                        </tr>
                                        <tr>
                                            <td><b>←&→</b>: Pan Tree</td>
                                            <td><b>U</b>: Upgrade Tree</td>
                                        </tr>
                                        <tr>
                                            <td><b>N</b>: Level Up</td>
                                            <td><b>R</b>: Override</td>
                                        </tr>
                                    </table>
                                    <br>
                                    <hr>
                                    <optionsheader>Beta Tester Controls:</optionsheader>
                                    <table class="optionsTable">
                                        <tr>
                                            <td><b>+</b>: Rainbow</td>
                                            <td><b>X</b>: Passive</td>
                                        </tr>
                                        <tr>
                                            <td><b>`</b>: Testbed</td>
                                            <td><b>Y</b>: Reset Color</td>
                                        </tr>
                                        <tr>
                                            <td><b>K</b>: Suicide</td>
                                            <td><b>L</b>: Debug Info</td>
                                        </tr>
                                    </table>
                                    <br>
                                    <hr>
                                    <optionsheader>Developer Controls:</optionsheader>
                                    <table class="optionsTable">
                                        <tr>
                                            <td><b>Z</b>: Drag</td>
                                            <td><b>F</b>: Spawn</td>
                                        </tr>
                                        <tr>
                                            <td><b>T</b>: Teleport</td>
                                            <td><b>B</b>: Ran Color</td>
                                        </tr>
                                        <tr>
                                            <td><b>G</b>: Kill</td>
                                            <td><b>J</b>: Stealth</td>
                                        </tr>
                                        <tr>
                                            <td><b>;</b>: Godmode</td>
                                            <td><b>\</b>: Tank</td>
                                        </tr>
                                    </table>
                                    <hr>
                                </div>
                                <optionsheader>To change settings, click the gear on the top left</optionsheader>
                                <hr>
                                <optionsheader>Miscellaneous Links</optionsheader>
                                <div class="links">
                                    <a tabindex="-1" href="https://discord.gg/ShsZTkZb8P" target="_blank">Discord</a>
                                </div>
                            </div>
                        </div>
                        <div class="menuInputHolder">
                            <input type="text" autofocus tabindex="1" spellcheck="false" placeholder="This is the tale of:"
                                id="playerNameInput" maxlength="24" />
                            <div>
                                <button id="startButton" tabindex="2">Play</button>
                            </div>
                            <div id="startMenuSlidingTrigger">
                                <h3 class="nopadding">🡿 Extra Stuff 🡾</h3>
                            </div>
                        </div>
                    </div>
                    <!--<div class="startMenuHolder" allowtransparency="true">
                                <iframe id="patchNotesIFrame" seamless="seamless" frameborder="0"
                                    onload="if(!this.src)this.src='./changelog.html?a='+Date.now()">Patch notes should go here. If you see this message, then something went wrong!</iframe>
                            </div>-->
                    <div class="startMenuHolder shadowScroll" id="patchHolder" style="padding-left: 18px;">
                    </div>
                    <script>
                        void async function () {
                            document.getElementById("patchHolder").innerHTML = ((await (await fetch("./changelog.html")).text()).replaceAll("." + "/", "./"));
                        }()
                    </script>
                </div>
            </div>
    
            <div class="popup" style="display: none;">
                <h1>Title</h1>
                <span>Message</span><br />
                <div>
                    <button onclick="document.querySelector('.popup').style.display = 'none';">Close</button>
                </div>
            </div>
            <div class="achievementsHolder" id="achievementsHolder">
                <div id="achievementsClose"
                    onclick="document.getElementsByClassName('achievementsHolder')[0].style.display = 'none'"></div>
                <h1 id="achievementsHeader">Achievements</h1>
                <hr>
                <div id="achievementsDisplay" class="shadowScroll"></div>
                <h1>Player Stats</h1>
                <hr>
                <table id="achievementsStatsTable"></table>
            </div>
        </div>
        <div class="signInDiv" id="signInDiv">
            <button class="signInDiscord signInButton" id="signInButton"><img id="signInButtonImage" src="/resources/Discord.png"> <span id="signInButtonText">Sign in with discord</span></button>
            <button class="signInOut signInButton" id="signInOut" style="display: none;">Log out</button>
        </div>
    </div>
    
    <input type="password" id="specialRoomToken" placeholder="Special Room Token">

    <script>
        window.quickurl = "./";
    </script>
    <!-- Preloads.js -->
    <script defer>
        {
            (function () {
                try {
                    if (!["localhost", "", "exoglitch.io", ".rivet.gg"].includes(location.hostname)) {
                        //    location.href = "https://exoglitch.io/";
                    }

                    function loadFromStorage() {
                        return (localStorage.getItem("popups") || "").split(",");
                    }

                    window.markAsRead = function markAsRead(item) {
                        localStorage.setItem("popups", [...loadFromStorage(), item].join(","));
                    }

                    window.closePopup = function closePopup(item) {
                        document.getElementById("mainWrapper").removeChild(document.getElementById(item));
                    }

                    function postAlert(alert) {
                        if (loadFromStorage().includes(alert.name)) {
                            return;
                        }
                        console.log(alert);
                        const popup = document.createElement("div");
                        popup.classList.add("popup");
                        popup.id = alert.name;
                        popup.innerHTML += `<span>${alert.title}</span><br/>${alert.text}<br/><button onclick="closePopup('${alert.name}');">Close</button><button onclick="markAsRead('${alert.name}');closePopup('${alert.name}');">Mark As Read</button><br/><span class="small">${new Date(alert.timeStamp)}</span>`;
                        document.getElementById("mainWrapper").appendChild(popup);
                    }
                    //fetch("//pine-mint-smartphone.glitch.me/announcements.json").then(r => r.json()).then(json => json.announcements.forEach(postAlert));

                    // Do screen size adjustment
                    let element = document.getElementById("mainWrapper");
                    let scalval = 130; ///Android|webOS|iPhone|iPad|iPod|BlackBerry|android|mobi/i.test(navigator.userAgent) ? 150 : 120;
                    function adjust() {
                        if (navigator.userAgent.search("Firefox") === -1) element.style.zoom = `${Math.round(Math.min(window.innerWidth / 1920, window.innerHeight / 1080) * scalval)}%`;
                    }
                    setInterval(adjust, 25);
                    adjust();

                    // Load ads
                    (adsbygoogle = window.adsbygoogle || []).push({});
                } catch (e) {
                    console.log("Error with preloads!");
                    console.error(e)
                }

                // Load ad
                const googleAdUrl = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js'
                try {
                    fetch(new Request(googleAdUrl)).catch(_ => window.adBlockEnabled = true)
                } catch (e) {
                    window.adBlockEnabled = true
                }

                let adInterval = setInterval(() => {
                    let adBox = document.getElementById("bottomPageAd")
                    if (!adBox) {
                        clearInterval(adInterval)
                        return
                    }
                    if (adBox.getAttribute("data-ad-status") !== "filled" || adBox.getAttribute("data-ad-status") !== "done") {
                        adBox.style.backgroundImage = "url('./resources/exoglitch-io-logo.png')"
                        adBox.title = "Advertisement"
                        adBox.onclick = () => {
                            window.open("https://woomy-onlint.glitch.me", "_blank")
                        }
                    } else {
                        adBox.style.backgroundImage = ""
                        adBox.style.onclick = () => { }
                        clearInterval(adInterval)
                        return
                    }
                }, 300)

                /// Discord sign in ///
                // Register token
                let code = new URLSearchParams(window.location.search).get("code")
                if (code) {
                    localStorage.setItem("discordCode", code);
                    window.location.replace(isLocal ? "http://localhost:29492" : isBeta ? "https://beta.exoglitch.io" : isEvent ? "https://event.exoglitch.io" : "https://exoglitch.io/")
                    return;
                }

                // Button onclicks
                document.getElementById("signInButton").onclick = () => {alert("Discord sign-in is no longer available. If you create your own room you'll have developer powers, if you join someone else's you wont. With developer powers press the ` key or the / key in-game to access developer tanks.")}//window.location.href = ("https://discord.com/api/oauth2/authorize?client_id=1116884853967814676&redirect_uri=https%3A%2F%2Fwoomy-api.glitch.me%2FdiscordOauth&response_type=code&scope=identify")
                document.getElementById("signInOut").onclick = () => {
                    localStorage.removeItem("discordCode")
                    window.location.reload()
                }

                // Do the sign in if its saved
                let savedCode = localStorage.getItem("discordCode")
                if (savedCode) {
                    fetch("https://discord.com/api/v10/users/@me", {
                        headers: {
                            Authorization: "Bearer " + savedCode,
                        },
                    }).then((res) => res.json()).then((userData) => {
                        if (userData.code != undefined) {
                            localStorage.removeItem("discordCode")
                            window.location.reload()
                            return
                        };
                        document.getElementById("signInButton").onclick = () => { }
                        document.getElementById("signInButtonImage").src = `https://cdn.discordapp.com/avatars/${userData.id}/${userData.avatar}`
                        document.getElementById("signInButtonText").innerHTML = userData.global_name
                        document.getElementById("signInOut").style.display = "initial"
                    }).catch(err => console.error(err))
                }


                window.servers = [
                    //{ rivetGamemode: "2dom.js", serverGamemode: "Domination" },
                    //{ rivetGamemode: "2mot.json", serverGamemode: "Mothership" },
                    { rivetGamemode: "2tdm.json", serverGamemode: "2 TDM" },
                    //{ rivetGamemode: "4tag.json", serverGamemode: "Tag" },
                    { rivetGamemode: "4tdm.json", serverGamemode: "4 TDM" },
                    { rivetGamemode: "ffa.json", serverGamemode: "FFA" },
                    { rivetGamemode: "maze.js", serverGamemode: "Maze" },
                    { rivetGamemode: "sbx.json", serverGamemode: "Sandbox" },
                    { rivetGamemode: "testbed.json", serverGamemode: "Testbed Event" }
                ]
                window.preloadsDoneCooking = true
            })();
        }
                async function getFullURL(data, ws) {
                    let res = null
                    if (ws) {
                        try {
                            if (!isLocal) {
                                let {
                                    RivetClient
                                } = await import("./rivet-api.js")
                                let client = new RivetClient({})
                                if (data[0]) {
                                    res = await client.matchmaker.lobbies.join({
                                        lobbyId: data[0]
                                    })
                                } else if (data[1].rivetGamemode !== undefined) {
                                    res = await client.matchmaker.lobbies.find({
                                        gameModes: [data[1].rivetGamemode]
                                    })
                                } else {
                                    alert("Error with preloading fullURL, rivet connection")
                                }
                            }
                            window.rivetLobby = isLocal ? "0" : res.lobby.lobbyId
                            window.rivetPlayerToken = isLocal ? "0" : res.player.token
                            window.rivetServerFound = true
                        } catch (err) {
                            console.error(err)
                            alert("The server you are trying to join is most likely full, you are at the ip limit, or an error occured, sorry! Please wait a bit then try again.")
                        }
                        return isLocal ? "ws://localhost:29492/?" : (`ws${window.location.protocol === "https:" ? "s" : ""}://${res.ports["default"].host}/?`)
                    } else {
                        return isLocal ? "http://localhost:29492/" : (`http${window.location.protocol === "https:" ? "s" : ""}://${window.location.hostname}${!window.location.port ? "/" : `:${window.location.port}/`}`);
                    }
                }
    </script>
    <!-- Menu.js -->
    <script defer>
        {
            const popup = document.querySelector(".popup");
            const popupTitle = popup.querySelector("h1");
            const popupMessage = popup.querySelector("span");

            function displayFirefoxSwitch() {
                popup.style.display = "block";
                popupTitle.textContent = "Dear Firefox User:";
                popupMessage.textContent = "We highly recommend that you do not play this game with the firefox browser. The game functions and performs much better on a Chromium based browser, such as Google Chrome, Opera GX or Microsoft Edge. You may play using Firefox, just be aware that multiple issues may manifest themselves.";
            }

            function displayCanvasNotSupported() {
                popup.style.display = "block";
                popupTitle.textContent = "Warning:";
                popupMessage.textContent = "Your browser does not support canvas. Please switch to a Chromium based browser, such as Google Chrome, Opera GX or Microsoft Edge.";
            }
            if (navigator.userAgent.search("Firefox") !== -1) displayFirefoxSwitch();


            function displayHowToPlay() {
                popup.style.display = "block";
                popupTitle.textContent = "How to play:";
                popupMessage.textContent = "I don't know how to put this here.";
            }

            function displayAbout() {
                popup.style.display = "block";
                popupTitle.textContent = "About ExoGlitch.io";
                popupMessage.textContent = "ExoGlitch.io is a fan-made spinoff between woomy-arras.io & arras.io & diep.io, with hundreds of tanks, bosses, and more!";
            }

            function displayAchievements() {
                document.getElementsByClassName('achievementsHolder')[0].style.display = 'block';
            };

            let canvas = document.createElement("canvas");
            if (!canvas || !canvas.getContext) displayCanvasNotSupported();
            if (canvas) canvas.remove();

            let clicked = 0;
            let div = document.getElementById("startMenuSlidingTrigger");
            let slide = document.getElementsByClassName("slider");
            div.addEventListener('click', function () {
                clicked = !clicked;
                for (let i = 0; i < slide.length; i++) slide[i].style.top = `${-280 * clicked}px`;
                if (clicked === 3) {
                    div.innerHTML = '<h3 class="nopadding">🡿 Extra Stuff 🡾</h3>';
                } else if (!clicked) {
                    div.innerHTML = '<h3 class="nopadding">🡿 Extra Stuff 🡾</h3>';
                } else {
                    div.innerHTML = '<h3 class="nopadding">🢄 Extra Stuff 🡽</h3>';
                };
            });

        }
    </script>
</body>
</html>
